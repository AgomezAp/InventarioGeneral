<app-navbar></app-navbar>

<div class="mobiliario-container">
  <!-- Header Compacto -->
  <header class="page-header">
    <div class="header-content">
      <button class="btn-back" (click)="cancelar()" aria-label="Volver">
        <i class="pi pi-arrow-left"></i>
      </button>
      <div class="header-info">
        <div class="header-badge">
          <i class="pi pi-building"></i>
          <span>Mobiliario</span>
        </div>
        <h1>Registrar Mobiliario</h1>
        <p class="subtitle">
          Agregue un nuevo tipo de mobiliario al inventario con su stock inicial
        </p>
      </div>
    </div>

    <!-- Botones en el header para ahorrar espacio -->
    <div class="header-actions">
      <button type="button" class="btn btn-secondary" (click)="cancelar()">
        <i class="pi pi-times"></i> Cancelar
      </button>
      <button
        type="submit"
        form="mobiliarioForm"
        class="btn btn-accent"
        [disabled]="loading || mobiliarioForm.invalid"
      >
        <i
          class="pi"
          [ngClass]="loading ? 'pi-spin pi-spinner' : 'pi-save'"
        ></i>
        {{ loading ? "Guardando..." : "Guardar" }}
      </button>
    </div>
  </header>

  <form
    [formGroup]="mobiliarioForm"
    (ngSubmit)="onSubmit()"
    id="mobiliarioForm"
    class="form-grid"
  >
    <!-- COLUMNA IZQUIERDA -->
    <div class="form-column">
      <!-- Información Básica -->
      <section class="section-card">
        <div class="section-card-header">
          <h3><i class="pi pi-info-circle"></i> Información Básica</h3>
        </div>
        <div class="section-card-body">
          <div class="form-row">
            <div class="form-group">
              <label for="nombre">Nombre <span class="required">*</span></label>
              <input
                type="text"
                id="nombre"
                formControlName="nombre"
                placeholder="Ej: Silla ergonómica"
                class="custom-input"
                [class.invalid]="isFieldInvalid('nombre')"
              />
              <span class="error-message" *ngIf="isFieldInvalid('nombre')">
                <i class="pi pi-exclamation-circle"></i>
                {{ getFieldError("nombre") }}
              </span>
            </div>

            <div class="form-group">
              <label for="categoria"
                >Categoría <span class="required">*</span></label
              >
              <div class="custom-select-wrapper">
                <select
                  id="categoria"
                  formControlName="categoria"
                  class="custom-select"
                  [class.invalid]="isFieldInvalid('categoria')"
                >
                  <option value="">Seleccione</option>
                  <option *ngFor="let cat of categorias" [value]="cat.value">
                    {{ cat.label }}
                  </option>
                </select>
                <i class="pi pi-chevron-down select-arrow"></i>
              </div>
            </div>
          </div>

          <div class="form-group">
            <label for="descripcion">Descripción</label>
            <textarea
              id="descripcion"
              formControlName="descripcion"
              rows="2"
              placeholder="Descripción detallada (opcional)"
              class="custom-textarea"
            ></textarea>
          </div>
        </div>
      </section>

      <!-- Stock y Ubicación COMBINADOS -->
      <section class="section-card">
        <div class="section-card-header">
          <h3><i class="pi pi-chart-bar"></i> Stock y Ubicación</h3>
        </div>
        <div class="section-card-body">
          <div class="form-row four-columns">
            <div class="form-group">
              <label for="unidadMedida"
                >Unidad <span class="required">*</span></label
              >
              <div class="custom-select-wrapper">
                <select
                  id="unidadMedida"
                  formControlName="unidadMedida"
                  class="custom-select"
                >
                  <option
                    *ngFor="let unidad of unidadesMedida"
                    [value]="unidad.value"
                  >
                    {{ unidad.label }}
                  </option>
                </select>
                <i class="pi pi-chevron-down select-arrow"></i>
              </div>
            </div>

            <div class="form-group">
              <label for="stockActual"
                >Stock <span class="required">*</span></label
              >
              <input
                type="number"
                id="stockActual"
                formControlName="stockActual"
                min="0"
                class="custom-input"
                [class.invalid]="isFieldInvalid('stockActual')"
              />
            </div>

            <div class="form-group">
              <label for="precioUnitario">Precio</label>
              <input
                type="number"
                id="precioUnitario"
                formControlName="precioUnitario"
                min="0"
                step="0.01"
                placeholder="0.00"
                class="custom-input"
              />
            </div>

            <div class="form-group">
              <label for="ubicacionAlmacen">Ubicación</label>
              <input
                type="text"
                id="ubicacionAlmacen"
                formControlName="ubicacionAlmacen"
                placeholder="Bodega, Estante..."
                class="custom-input"
              />
            </div>
          </div>

          <div class="form-group">
            <label for="proveedor">Proveedor</label>
            <input
              type="text"
              id="proveedor"
              formControlName="proveedor"
              placeholder="Nombre del proveedor"
              class="custom-input"
            />
          </div>
        </div>
      </section>
    </div>

    <!-- COLUMNA DERECHA -->
    <div class="form-column">
      <!-- Imagen -->
      <section class="section-card section-image">
        <div class="section-card-header">
          <h3><i class="pi pi-camera"></i> Imagen</h3>
        </div>
        <div class="section-card-body">
          <div class="image-upload-container">
            <div class="image-preview" *ngIf="imagenPreview">
              <img [src]="imagenPreview" alt="Preview" />
              <button
                type="button"
                class="btn-remove-image"
                (click)="removeImage()"
              >
                <i class="pi pi-times"></i>
              </button>
            </div>

            <label class="upload-area" for="imagen" *ngIf="!imagenPreview">
              <input
                type="file"
                id="imagen"
                (change)="onFileSelected($event)"
                accept="image/jpeg,image/jpg,image/png,image/gif"
                hidden
              />
              <div class="upload-content">
                <i class="pi pi-cloud-upload"></i>
                <span>Click para subir imagen</span>
                <span class="upload-hint">JPG, PNG (máx. 5MB)</span>
              </div>
            </label>
          </div>
        </div>
      </section>

      <!-- Observaciones -->
      <section class="section-card">
        <div class="section-card-header">
          <h3><i class="pi pi-bookmark"></i> Observaciones</h3>
        </div>
        <div class="section-card-body">
          <div class="form-group no-margin">
            <textarea
              id="observaciones"
              formControlName="observaciones"
              rows="3"
              placeholder="Notas adicionales..."
              class="custom-textarea"
            ></textarea>
          </div>
        </div>
      </section>
    </div>
  </form>
</div>
