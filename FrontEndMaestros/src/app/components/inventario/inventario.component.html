<app-navbar></app-navbar>

<div class="inventario-container">
  <!-- Header con estadísticas -->
  <div class="header-section">
    <div class="header-title">
      <h1><i class="fa-solid fa-warehouse"></i> Inventario de Dispositivos</h1>
      <p class="subtitle">Gestión completa del inventario tecnológico</p>
    </div>
    
    <div class="header-actions">
      <button class="btn-agregar" (click)="irAAgregar()">
        <i class="fa-solid fa-plus"></i> Agregar Dispositivo
      </button>
      <button class="btn-entrega" (click)="irAEntrega()">
        <i class="fa-solid fa-file-signature"></i> Crear Acta de Entrega
      </button>
    </div>
  </div>

  <!-- Tarjetas de estadísticas -->
  <div class="stats-grid">
    <div class="stat-card stat-total">
      <div class="stat-icon"><i class="fa-solid fa-boxes-stacked"></i></div>
      <div class="stat-info">
        <span class="stat-number">{{ dispositivos.length }}</span>
        <span class="stat-label">Total Dispositivos</span>
      </div>
    </div>
    
    <div class="stat-card stat-disponible">
      <div class="stat-icon"><i class="fa-solid fa-check-circle"></i></div>
      <div class="stat-info">
        <span class="stat-number">{{ contarPorEstado('disponible') }}</span>
        <span class="stat-label">Disponibles</span>
      </div>
    </div>
    
    <div class="stat-card stat-prestado">
      <div class="stat-icon"><i class="fa-solid fa-hand-holding"></i></div>
      <div class="stat-info">
        <span class="stat-number">{{ contarPorEstado('prestado') }}</span>
        <span class="stat-label">Prestados</span>
      </div>
    </div>
    
    <div class="stat-card stat-danado">
      <div class="stat-icon"><i class="fa-solid fa-exclamation-triangle"></i></div>
      <div class="stat-info">
        <span class="stat-number">{{ contarPorEstado('dañado') }}</span>
        <span class="stat-label">Dañados</span>
      </div>
    </div>
    
    <div class="stat-card stat-perdido">
      <div class="stat-icon"><i class="fa-solid fa-question-circle"></i></div>
      <div class="stat-info">
        <span class="stat-number">{{ contarPorEstado('perdido') }}</span>
        <span class="stat-label">Perdidos</span>
      </div>
    </div>
    
    <div class="stat-card stat-obsoleto">
      <div class="stat-icon"><i class="fa-solid fa-clock"></i></div>
      <div class="stat-info">
        <span class="stat-number">{{ contarPorEstado('obsoleto') }}</span>
        <span class="stat-label">Obsoletos</span>
      </div>
    </div>
  </div>

  <!-- Filtros -->
  <div class="filtros-section">
    <div class="filtro-grupo">
      <label>Estado:</label>
      <select [(ngModel)]="filtroEstado" (change)="aplicarFiltros()">
        <option value="todos">Todos los estados</option>
        <option *ngFor="let estado of estados" [value]="estado">
          {{ estado | titlecase }}
        </option>
      </select>
    </div>
    
    <div class="filtro-grupo">
      <label>Categoría:</label>
      <select [(ngModel)]="filtroCategoria" (change)="aplicarFiltros()">
        <option value="todas">Todas las categorías</option>
        <option *ngFor="let cat of categorias" [value]="cat">
          {{ cat | titlecase }}
        </option>
      </select>
    </div>
    
    <div class="filtro-grupo filtro-busqueda">
      <label>Buscar:</label>
      <input 
        type="text" 
        [(ngModel)]="filtroBusqueda" 
        (input)="aplicarFiltros()"
        placeholder="Nombre, marca, modelo, serial, IMEI..."
      />
      <i class="fa-solid fa-search"></i>
    </div>
  </div>

  <!-- Mensaje de error -->
  <div class="error-message" *ngIf="error">
    <i class="fa-solid fa-exclamation-circle"></i> {{ error }}
  </div>

  <!-- Loading -->
  <div class="loading" *ngIf="loading">
    <i class="fa-solid fa-spinner fa-spin"></i> Cargando dispositivos...
  </div>

  <!-- Tabla de dispositivos -->
  <div class="tabla-container" *ngIf="!loading">
    <table class="tabla-dispositivos">
      <thead>
        <tr>
          <th>Categoría</th>
          <th>Nombre</th>
          <th>Marca / Modelo</th>
          <th>Serial / IMEI</th>
          <th>Estado</th>
          <th>Condición</th>
          <th>Ubicación</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let dispositivo of dispositivosPaginados" [class]="'row-' + dispositivo.estado">
          <td class="td-categoria">
            <span class="categoria-badge">
              <i class="fa-solid" [ngClass]="getCategoriaIcon(dispositivo.categoria)"></i>
              {{ dispositivo.categoria | titlecase }}
            </span>
          </td>
          <td class="td-nombre">
            <strong>{{ dispositivo.nombre }}</strong>
          </td>
          <td class="td-marca">
            <span *ngIf="dispositivo.marca">{{ dispositivo.marca }}</span>
            <span *ngIf="dispositivo.modelo" class="modelo">{{ dispositivo.modelo }}</span>
          </td>
          <td class="td-serial">
            <span *ngIf="dispositivo.serial" class="serial">S/N: {{ dispositivo.serial }}</span>
            <span *ngIf="dispositivo.imei" class="imei">IMEI: {{ dispositivo.imei }}</span>
          </td>
          <td class="td-estado">
            <span class="estado-badge" [ngClass]="getEstadoClass(dispositivo.estado)">
              <i class="fa-solid" [ngClass]="getEstadoIcon(dispositivo.estado)"></i>
              {{ dispositivo.estado | uppercase }}
            </span>
          </td>
          <td class="td-condicion">
            <span class="condicion-badge condicion-{{ dispositivo.condicion }}">
              {{ dispositivo.condicion | titlecase }}
            </span>
          </td>
          <td class="td-ubicacion">
            <i class="fa-solid fa-location-dot"></i>
            {{ dispositivo.ubicacion || 'Sin ubicación' }}
          </td>
          <td class="td-acciones">
            <button class="btn-accion btn-ver" (click)="verDetalle(dispositivo)" title="Ver detalle completo">
              <i class="fa-solid fa-eye"></i>
            </button>
            <button class="btn-accion btn-editar" (click)="editarDispositivo(dispositivo)" title="Editar dispositivo">
              <i class="fa-solid fa-edit"></i>
            </button>
            <button class="btn-accion btn-historial" (click)="verTrazabilidad(dispositivo)" title="Ver historial">
              <i class="fa-solid fa-history"></i>
            </button>
            <button 
              class="btn-accion btn-estado" 
              (click)="cambiarEstado(dispositivo)" 
              title="Cambiar estado"
              *ngIf="dispositivo.estado !== 'entregado'"
            >
              <i class="fa-solid fa-exchange-alt"></i>
            </button>
          </td>
        </tr>
        
        <tr *ngIf="dispositivosFiltrados.length === 0">
          <td colspan="8" class="sin-datos">
            <i class="fa-solid fa-inbox"></i>
            <p>No se encontraron dispositivos</p>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Paginación -->
  <div class="paginacion" *ngIf="totalPaginas > 1">
    <button 
      class="btn-pagina" 
      (click)="cambiarPagina(paginaActual - 1)"
      [disabled]="paginaActual === 1"
    >
      <i class="fa-solid fa-chevron-left"></i>
    </button>
    
    <span class="pagina-info">
      Página {{ paginaActual }} de {{ totalPaginas }}
    </span>
    
    <button 
      class="btn-pagina" 
      (click)="cambiarPagina(paginaActual + 1)"
      [disabled]="paginaActual === totalPaginas"
    >
      <i class="fa-solid fa-chevron-right"></i>
    </button>
    
    <span class="total-info">
      ({{ dispositivosFiltrados.length }} dispositivos)
    </span>
  </div>
</div>
